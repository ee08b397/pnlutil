#!/bin/bash -e

source util.sh

HELP="
Run in directory with 'data.sh'.
Prints all <var> files that don't exist for \$caselist.

Usage:

    ${0##*/} <var>

"

# check args and ./data.sh
[[ $# -lt 1 || $1 == "-h" || $1 == "--help" ]] && usage 1
[ -f ./data.sh ] || { echo "Run in directory with 'data.sh'"; usage 1; }
var=$1

# check var is set
source ./data.sh
[ -n "${!1}" ] || { echo "Set '$1' in data.sh"; exit 1; }
[ -n "$caselist" ] || { echo "Set 'caselist' in data.sh"; exit 1; }

# if var is remote 
if [[ ${!var} == *:* ]]; then
    IFS=":" read -r server remotepath <<<"${!var}"
    files=$(all $var $caselist)  # `all` defined in util.sh
    ssh $server "for i in $files; do [ ! -e "\$i" ] && echo \$i; done"
    exit 0
fi

# local
for case in $caselist; do
    source ./data.sh
    [ ! -e ${!1} ] && printf "%s " ${!1}
done
