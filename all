#!/bin/bash -e

SCRIPT=$(readlink -m $(type -p $0))
SCRIPTDIR=${SCRIPT%/*}      
source $SCRIPTDIR/util.sh

HELP="
Run in directory with 'data.sh', or set DATADIR with file path that contains
one.  Prints all <var> files for \$caselist or 'caselist.txt' or a list of case
id's.

Usage:

    ${0##*/} <var> [caselist.txt | case1 case2 ... caseN]

"

datash="data.sh"
[ -n "${DATADIR-}" ] && datash="$DATADIR/data.sh"

[ -f "$datash" ] || { echo "Run in directory with 'data.sh' or source it first, e.g. 'setenv DATADIR=/path/to/proj or 'source /path/to/my/project/data.sh'"; usage 1; }
source "$datash"

[[ $# -lt 1 || $1 == "-h" || $1 == "--help" ]] && usage 1
var=$1; shift
if [[ $# -gt 1 ]]; then
    cases=$@
elif [[ $# -eq 1 ]]; then
    cases=$(cat "$1" | awk '{print $1}') || { echo "Failed to read '$1'"; usage 1; }
else
    cases=$caselist
    [[ -n "$cases" ]] || { echo "Set 'caselist' in data.sh, or give a 'caselist.txt' or list of case id's as an argument"; usage 1; }
fi

[ -n "${!var}" ] || { echo "Set '$var' in data.sh"; exit 1; }

for case in $cases; do
    source "$datash"
    printf "%s\n" ${!var}
done
