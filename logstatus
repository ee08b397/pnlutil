#!/bin/bash -e

SCRIPT=$(readlink -m $(type -p $0))
SCRIPTDIR=${SCRIPT%/*}      
source $SCRIPTDIR/util.sh

checkset_SetUpData status_vars

# if logfile doesn't exist, create it with header
logfile="./statuslog.csv"
header="datetime,"
for var in $status_vars; do
    header="$header,$var"
done
echo -e "$header,total" >> "$logfile"

# add status row
row="'$(date +"%Y-%m-%d %H:%M")'"
for var in $status_vars; do
    row="$row,$(status $var | cut -d"/" -f1)"
    total=$(status $var | cut -d"/" -f2)
done
echo -e "$row,$total" >> "$logfile"
cat "$logfile" | column -t -s","
